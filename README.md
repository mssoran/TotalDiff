# TODO
Example:
to run: `bazel run totaldiff:totaldiff`

# Build Deployment Jar

```
bazel build totaldiff:totaldiff_deploy.jar
```

Then you can copy `bazel-bin/totaldiff/totaldiff_build.jar` or run it as:

```
java -jar bazel-bin/totaldiff/totaldiff_deploy.jar
```

# Arguments and Run Options

## Collect Data and Construct Info Tree
There are two sources for the data.
1) From a file that is previously collected data. The file name is passed by `infoTreeInputFileName` config.
While reading from a file, it's assumed that the file is generated by a previous run of this tool. If 
`infoTreeInputFileName` is empty, no data is read from any file.

2) By crawling the directories given by `dirs` config. Each directory listed in `dirs` is checked recursively
to find all the files and directories under it.

Configs used during data collection:
- `String: infoTreeInputFileName` - File name to read previously collected data. Should be collected with
the same/compatible config values with the current call.
- `String[]: dirs` - list of dir to crawl to collect data
- `boolean: compareHashes` - if true, every file is hashed and hash data is used during the analyze.
- `int: fileReadBufferSize` - size of buffer in bytes. Buffer is used when reading the files for hash computation.
- `String: infoTreeOutputFileName` - name of the file to write collected data. All the collected data will
be written to this file. If empty, collected data is not written to any file. 
- `boolean: overwriteInfoTreeOutputFile` - Determins the behavior if `infoTreeOutputFileName` file already
exists. If `infoTreeOutputFileName` exists and `overwriteInfoTreeOutputFile` is false, the command fails.

## Analyze 
This stage is analyzing data and finding duplicate files. If `analyze` config value is false, this stage
is skipped.

Configs used during analyze:
- `boolean: analyze` - If false, analyze stage is skipped.
- `boolean: printDuplicates` - If true, all found duplicate entries are written to console output.

## Output Generation
Generates an easily consumable output (text, graph, etc) from the analyze result. 

_**Work in progress**_

### DuplicatesAsEdgeGraphGenerator
### DuplicatesAsNodeGraphGenerator
### LargeDirPrinter

## Best practice to run:
1) Collect data by giving only `dirs`, not `infoTreeInputFileName`, and write the result to an output file:

```
java -jar totaldiff_deploy.jar --infoTreeInputFileName= --noanalyze --dirs=dir1:dir2:dir3 --infoTreeOutputFileName=outputfilename
bazel build totaldiff:totaldiff_deploy.jar && java -jar bazel-bin/totaldiff/totaldiff_deploy.jar --infoTreeInputFileName= --noanalyze --dirs=/Users/serdar/test --infoTreeOutputFileName=withdigestoutputtest.txt
```

2) If the processed data is very large, and it takes long time, it's more prone to fail during colelction.
If for any reason, collection fails in the middle of the process, it's possible to continue the data 
collection. To do it, first move the previous `outputfilename` output file as `inputfilename`, and feed
it to the next run as an input file

```
java -jar totaldiff_deploy.jar --infoTreeInputFileName=inputfilename --noanalyze --dirs=dir1:dir2:dir3 --infoTreeOutputFileName=outputfilename
bazel build totaldiff:totaldiff_deploy.jar && java -jar bazel-bin/totaldiff/totaldiff_deploy.jar --infoTreeInputFileName=withdigestinputtest.txt --noanalyze --dirs=/Users/serdar/test --infoTreeOutputFileName=withdigestoutputtest.txt
```

3) Analyze the data and create the output

```
java -jar totaldiff_deploy.jar  --infoTreeInputFileName=previouslygeneratedfile --analyze --infoTreeOutputFileName=
bazel build totaldiff:totaldiff_deploy.jar && java -jar bazel-bin/totaldiff/totaldiff_deploy.jar --infoTreeInputFileName=withdigestoutputtest.txt --analyze --infoTreeOutputFileName=

```

4) Then, you can visualize the generated graph

```
dot -Tsvg ldgraphOut.dot > hoho2.svg && open hoho2.svg
```

5) If you want to see a diff of two input files:
```
java -jar totaldiff_deploy.jar  --infoTreeInputFileName=previouslygeneratedfile --infoTreeSecondaryInputFileName=filterFromInputFile --infoTreeOutputFileName=
bazel build totaldiff:totaldiff_deploy.jar && java -jar bazel-bin/totaldiff/totaldiff_deploy.jar --infoTreeInputFileName=totalDiffYeniambarOutput.txt --infoTreeSecondaryInputFileName=totalDiffYeniambarOutputSiyahWD.txt --infoTreeOutputFileName=
```

# TODO

- [ ] Change the command format: `command --option1 --option2` . Because, different commands may need 
different options and limitations.
- [ ] Add support for incremental update of output file. It can work like: read the last file, list all files in all directories, if a file is not in list (how to decide? I's possible that the content is changed, but the name is not. Best way may be keeping the last change time. But it may be ok for now to look at size only.), only then hash the file and add to the list. If a file is in list but not on the disk, remove it from the list. This way it'll be faster during the second run. 
- [ ] Change the format of output file into json

